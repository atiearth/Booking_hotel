package com.cp.project.demo.model.forBooking;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import com.cp.project.demo.model.forRoom.Room;
import com.cp.project.demo.model.forStrategy.PaymentStrategy;
import com.cp.project.demo.model.forUser.User;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;

import jakarta.persistence.CascadeType;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.JoinColumn;
import jakarta.persistence.ManyToOne;
import jakarta.persistence.MapsId;
import jakarta.persistence.OneToMany;
import jakarta.persistence.OneToOne;
import jakarta.persistence.PrimaryKeyJoinColumn;
import jakarta.persistence.Table;
import jakarta.persistence.Transient;

@Entity
@Table(name = "booking")
public class Booking implements BookingSubject  {
	@Id
    @GeneratedValue(strategy = GenerationType.AUTO)
	private Integer bookingId;
	
	@OneToOne(cascade = CascadeType.ALL)
    @JoinColumn(name = "room_id") // เชื่อมโยงกับ room
    private Room room;

    @ManyToOne
    @JoinColumn(name = "user_id")
    @JsonIgnoreProperties("booking")
    private User user;
    
    private String paymentType;
    private Date BookingDate;
    private Date checkinDate;
    private Date checkoutDate;
    

    //------------------------ สำหรับ observer  ------------------------\\
    private String status;  // ใช้เพื่อแสดงสถานะของการจอง เช่น ว่าง , เต็ม
    @Transient
    private List<BookingObserver> observers = new ArrayList<>();
  //------------------------ สำหรับ observer  ------------------------\\
    
  //------------------------ สำหรับ Strategy  ------------------------\\
    private double totalPrice;
    @Transient
    private PaymentStrategy paymentStrategy;
    //------------------------ สำหรับ Strategy  ------------------------\\
    
    
	public Booking(Room room, User user, String paymentType,Date bookingDate, Date checkinDate, Date checkoutDate) {
		this.room = room;
		this.user = user;
		this.BookingDate = bookingDate;
		this.paymentType = paymentType;
		this.checkinDate = checkinDate;
		this.checkoutDate = checkoutDate;
		
	}
	
	public Integer getBookingId() {
		return bookingId;
	}
	public void setBookingId(Integer bookingId) {
		this.bookingId = bookingId;
	}
	
	public Room getRoom() {
		return room;
	}

	public void setRoom(Room room) {
		this.room = room;
	}

	public User getUser() {
		return user;
	}
	public void setUser(User user) {
		this.user = user;
	}
	public String getPaymentType() {
		return paymentType;
	}
	public void setPaymentType(String paymentType) {
		this.paymentType = paymentType;
	}
	public Date getCheckinDate() {
		return checkinDate;
	}
	public void setCheckinDate(Date checkinDate) {
		this.checkinDate = checkinDate;
	}
	public Date getCheckoutDate() {
		return checkoutDate;
	}
	public void setCheckoutDate(Date checkoutDate) {
		this.checkoutDate = checkoutDate;
	}
	
	
    public Date getBookingDate() {
		return BookingDate;
	}

	public void setBookingDate(Date bookingDate) {
		BookingDate = bookingDate;
	}

	//------------------------ สำหรับ observer  ------------------------\\
	public void addObserver(BookingObserver observer) {
        observers.add(observer);
    }
	
    @Override
    public void removeObserver(BookingObserver observer) {
        observers.remove(observer);
    }

    @Override
    public void notifyObservers() {
        for (BookingObserver observer : observers) {
            observer.update(this); 
        }
    }

    public void setStatus(String status) {
        this.status = status;
        notifyObservers();  
    }

    public String getStatus() {
        return status;
    }
    //------------------------ สำหรับ observer  ------------------------\\
    
    //------------------------ สำหรับ Strategy  ------------------------\\
    public void setPaymentStrategy(PaymentStrategy paymentStrategy) {
        this.paymentStrategy = paymentStrategy;
    }

    public void processPayment() {
        if (paymentStrategy == null) {
            throw new IllegalStateException("Payment strategy not set!");
        }
        paymentStrategy.pay(totalPrice);
    }
    //------------------------ สำหรับ Strategy  ------------------------\\
}
